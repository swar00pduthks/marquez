# Custom Helm values for Marquez deployment with Azure PostgreSQL and ACR images
# Generated by build-and-deploy.ps1

# Root-level service configuration (applies to all services)
service:
  type: LoadBalancer
  port: 80

# Marquez API configuration
marquez:
  # Use custom ACR images
  image:
    registry: marquezacrizeh.azurecr.io
    repository: marquez-api
    tag: "0.52.33-local"
    pullPolicy: Always
  
  # Increase replicas for HA
  replicaCount: 2
  
  # External Azure PostgreSQL configuration
  db:
    host: marquez-test-izeh.postgres.database.azure.com
    port: 5432
    name: marquez_test
    user: marquezadmin
    password: "${MARQUEZ_DB_PASSWORD}"
    
  # HikariCP Connection Pool Configuration
  # These settings help prevent long-running connections and connection leaks
  dbConnectionPool:
    maximumPoolSize: 20
    minimumIdle: 5
    connectionTimeout: 30000      # 30 seconds
    idleTimeout: 300000           # 5 minutes (reduced from default 10 min)
    maxLifetime: 600000           # 10 minutes (reduced from default 30 min)
    leakDetectionThreshold: 60000 # 1 minute - detect connection leaks
    validationTimeout: 5000       # 5 seconds
  
  # Resource limits
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

# Web UI configuration
web:
  enabled: true
  replicaCount: 1
  
  # Use custom ACR images
  image:
    registry: marquezacrizeh.azurecr.io
    repository: marquez-web
    tag: "0.52.33-local"
    pullPolicy: Always
  
  # Resource limits
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Disable bundled PostgreSQL chart (we're using Azure PostgreSQL)
postgresql:
  enabled: false
